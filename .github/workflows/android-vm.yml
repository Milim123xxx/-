name: Android Cloud VM

on:
  workflow_dispatch:

jobs:
  run-android:
    name: Boot Android VM
    runs-on: ubuntu-latest
    timeout-minutes: 120

    steps:
      - name: üß∞ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á QEMU
        run: |
          sudo apt update
          sudo apt install -y qemu-kvm wget unzip

      - name: üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Android ISO ‡∏à‡∏≤‡∏Å Dropbox
        run: |
          wget -O android.iso "https://www.dropbox.com/scl/fi/eh56gj9s3p4bsunciu3c2/android-x86_64-9.0-r2.iso?rlkey=kkuy6bqixv5cpumjbbxlgq3td&st=p7oumbo2&dl=1"

      - name: üíæ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡∏¥‡∏™‡∏Å‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Android
        run: |
          qemu-img create -f qcow2 android.qcow2 8G

      - name: üöÄ ‡∏£‡∏±‡∏ô Android VM
        run: |
          nohup qemu-system-x86_64 \
            -m 2048 \
            -smp 2 \
            -cdrom android.iso \
            -hda android.qcow2 \
            -boot d \
            -vnc :1 \
            -net nic -net user \
            -enable-kvm \
            -cpu host \
            -name "Android Cloud VM" &

      - name: üîó ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏≠‡∏£‡πå‡∏ï VNC
        run: |
          echo "VM Android ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏û‡∏≠‡∏£‡πå‡∏ï VNC :1"
          echo "‡πÉ‡∏ä‡πâ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ VNC ‡πÄ‡∏ä‡πà‡∏ô RealVNC ‡∏´‡∏£‡∏∑‡∏≠ noVNC"
          echo "‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö noVNC:"
          echo "https://novnc.com/noVNC/?autoconnect=true&host=127.0.0.1&port=5901"
